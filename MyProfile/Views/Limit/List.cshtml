@{
    ViewData["Title"] = "Project list - Pages";
}

@section Styles {
    <link href="~/vendor/libs/flatpickr/plugins/monthSelect.css" rel="stylesheet" />
    <link href="~/vendor/libs/select2/select2.css" rel="stylesheet" />
}

@section Scripts {
    <script src="~/vendor/libs/flatpickr/plugins/monthSelect.js"></script>
    <script src="~/vendor/libs/select2/select2.js"></script>
    <script src="~/vendor/libs/masonry/masonry.js"></script>

    <script src="~/app_js/limit-list.js"></script>
}

<section id="limit-list-vue">


    <h4 class="d-flex flex-wrap w-100 font-weight-bold pt-2 mb-4">
        <span class="lnr lnr-frame-expand display-4 text-primary mr-2"></span>
        <span class="px-0 pb-2 pt-2">
            Лимиты
        </span>
        <span class="px-0 pb-2 ml-4">
            <a class="btn btn-outline-primary rounded-pill" href="javascript:void(0)" v-on:click="edit()">Добавить новый лимит</a>
        </span>
    </h4>

    <ul class="nav container-m-nx bg-lighter container-p-x py-1 mb-4">
        <li class="nav-item">
            <a v-bind:class="['nav-link', activeLimitPeriodTypeID == -1 ? 'font-weight-bold pl-0 text-body':'text-muted']" href="javascript:void(0)"
               v-on:click="activeLimitPeriodTypeID = -1; reloadView()">Все лимиты</a>
        </li>
        <li class="nav-item">
            <a v-bind:class="['nav-link', activeLimitPeriodTypeID == 1 ? 'font-weight-bold pl-0 text-body':'text-muted']" href="javascript:void(0)"
               v-on:click="activeLimitPeriodTypeID = 1; reloadView()">По дням</a>
        </li>
        <li class="nav-item">
            <a v-bind:class="['nav-link', activeLimitPeriodTypeID == 3 ? 'font-weight-bold pl-0 text-body':'text-muted']" href="javascript:void(0)"
               v-on:click="activeLimitPeriodTypeID = 3; reloadView()">По месяцам</a>
        </li>
    </ul>

    <div class="row" id="limits">
        <div class="col-sm-6 col-xl-4 pt-5 masonry-item-sizer position-absolute"></div>
        <div class="col-sm-6 col-xl-4 masonry-item"
             v-for="limit in limits"
             v-bind:class="limit.isShow && (activeLimitPeriodTypeID == -1 || limit.periodTypeID == activeLimitPeriodTypeID) ? '' : 'd-none'"
             v-bind:data-id="'limit_' + limit.id">
            <div class="card mb-4 custom-card-hover" v-bind:class="limit.isOwner ? 'border-primary' : 'border-secondary'">
                @*border-secondary*@
                <div class="card-body card-body pb-0">
                    <div class="d-flex justify-content-between align-items-start">
                        <a href="javascript:void(0)" class="text-body text-big font-weight-semibold" v-on:click="edit(limit)" title="Редактировать">{{ limit.name }}</a>

                        <span class="badge badge-success align-text-bottom ml-1" v-show="limit.periodTypeID == 1">{{ limit.periodName }}</span>
                        <span class="badge badge-info align-text-bottom ml-1" v-show="limit.periodTypeID == 3">{{ limit.periodName }}</span>
                    </div>
                    <div class="mt-3">
                        {{ limit.description }}
                    </div>
                </div>
                <div class="card-body py-3">
                    <div class="text-muted small mb-2">Категории</div>
                    <div class="d-flex flex-wrap">
                        <div class="badge badge-pill badge-outline-secondary mr-1 mb-1" v-for="section in limit.sections" v-bind:style="'box-shadow: 0 0 0 1px '+ section.cssColor +' inset; color: '+ section.cssColor">
                            <i v-bind:class="section.cssIcon"></i>
                            <span class="ml-1">{{section.name}}</span>
                        </div>
                    </div>
                </div>
                <hr class="m-0">
                @*<div class="progress rounded-0" style="height: 3px;">
                        <div class="progress-bar" style="width: 100%"></div>
                    </div>*@
                <div class="card-body pb-2 pt-1">
                    <div class="text-muted small mb-0">Цель</div>
                    <div class="d-flex flex-wrap">
                        <h6 class="mt-1 mb-1">{{ new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'RUB' }).format(limit.limitMoney) }}</h6>
                    </div>
                </div>
                <div class="card-body pt-0 pb-2">
                    <div class="row">
                        <div class="col-5">
                            <div class="text-muted small display-inline">Начало</div>
                            <div class="font-weight-bold">{{  getDateByFormat(limit.dateStart, 'MM.YYYY') }}</div>
                        </div>
                        <div class="col-7">
                            <div class="text-muted small display-inline">Конец</div>
                            <span class="badge badge-outline-danger ml-1" v-show="limit.isFinishLimit">Завершен</span>
                            <div class="font-weight-bold" v-show="limit.dateEnd">{{  getDateByFormat(limit.dateEnd, 'MM.YYYY') }}</div>
                        </div>
                        @*<div class="col-4">
                                <div class="text-muted small display-inline">Цель</div>
                                <h6 class="mt-1">{{ new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'RUB' }).format(limit.limitMoney) }}</h6>
                            </div>*@
                    </div>
                </div>
                <hr class="m-0">
                <div class="card-footer p-3">
                    <a href="void:javascript(0)" class="btn btn-primary btn-sm" v-on:click="edit(limit)">
                        <i class="far fa-edit pr-2"></i>Редактировать
                    </a>
                    <a href="/Budget/Month?templateID=8" title="Посмотреть" class="btn icon-btn btn-sm btn-outline-secondary">
                        <i class="far fa-eye"></i>
                    </a>
                    <a href="/Template/Delete/8" title="Удалить" class="btn icon-btn btn-sm btn-outline-secondary">
                        <span class="ion ion-md-trash"></span>
                    </a>
                    <div class="d-inline-flex align-items-center align-middle float-right" v-if="!limit.isOwner">
                        <span class="px-1 ml-2 ml-lg-0">{{ limit.userName }}</span>
                        <img v-bind:src="limit.imageLink" alt="User image" class="d-block ui-w-30 rounded-circle">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <hr class="border-light mt-2 mb-4">
    @await Html.PartialAsync("_EditLimit")
</section>

@await Html.PartialAsync(@"../Settings/Settings.cshtml", "Limit/List")