var SubScriptionListVue=new Vue({el:"#subscription-list-vue",data:{userSubScriptions:[],baseSubScriptions:[],subScriptions:[],subScription:{},option:{},pricings:[],isSaving:!1,numberID:-1,activeViewID:1,searchText:null},watch:{searchText:function(n){n&&(n=n.toLocaleLowerCase());for(var t=0;t<this.subScriptions.length;t++)this.subScriptions[t].isShow=this.subScriptions[t].title.toLocaleLowerCase().indexOf(n)>=0}},computed:{anySelectedPricing:function(){return this.pricings.some(n=>n.isSelected)}},mounted:function(){this.userLoad();this.baseLoad();$("#modal-limit").on("hidden.bs.modal",function(){SubScriptionListVue.closeEditModal()})},methods:{userLoad:function(){return $.ajax({type:"GET",url:"/SubScription/GetUserSubScriptions",contentType:"application/json",dataType:"json",context:this,success:function(n){n.isOk==!0&&(this.userSubScriptions=n.userSubScriptions,this.userSubScriptions.length==0?(this.activeViewID=1,this.subScriptions=this.baseSubScriptions):(this.activeViewID=-1,this.subScriptions=this.userSubScriptions))},error:function(n){console.log(n)}})},baseLoad:function(){return $.ajax({type:"GET",url:"/SubScription/GetBaseSubScriptions",contentType:"application/json",dataType:"json",context:this,success:function(n){n.isOk==!0&&(this.baseSubScriptions=n.baseSubScriptions,this.activeViewID==1&&(this.subScriptions=this.baseSubScriptions))},error:function(n){console.log(n)}})},add:function(n){this.subScription=n;for(var t=0;t<n.options.length;t++)if(n.options[t].isSelected){this.option=n.options[t];this.pricings=n.options[t].pricings;continue}$("#modal-subscription").modal("show")},selectOption:function(n){if(!(this.subScription.userSubScriptionID>0)){this.option=n;for(var t=0;t<this.subScription.options.length;t++){let i=n.id==this.subScription.options[t].id;this.subScription.options[t].isSelected=i;i&&(this.pricings=this.subScription.options[t].pricings)}}},selectPrice:function(n){if(!(this.subScription.userSubScriptionID>0)){for(var t=0;t<this.pricings.length;t++){let i=n.id==this.pricings[t].id;this.pricings[t].isSelected=i}this.subScription.userTitle=this.subScription.title;this.subScription.userPrice=n.price;this.subScription.userPriceForMonth=n.pricePerMonth;this.subScription.userPricingID=n.id;this.subScription.userSubScriptionID=0}},save:function(){if(this.checkValid()!=!1)return this.isSaving=!0,$.ajax({type:"POST",url:"/SubScription/Save",data:JSON.stringify(this.subScription),context:this,contentType:"application/json",dataType:"json",success:function(n){n.isOk&&(this.userLoad(),$("#modal-subscription").modal("hide"));this.isSaving=!1},error:function(){this.isSaving=!1}})},checkValid:function(){let n=!0;return this.subScription.userTitle&&this.subScription.userTitle.length>0?$("#userTitle").removeClass("is-invalid"):($("#userTitle").addClass("is-invalid"),n=!1),this.subScription.userPrice&&this.subScription.userPrice*1>0?$("#userPrice").removeClass("is-invalid"):($("#userPrice").addClass("is-invalid"),n=!1),this.subScription.userPriceForMonth&&this.subScription.userPriceForMonth*1>0?$("#userPriceForMonth").removeClass("is-invalid"):($("#userPriceForMonth").addClass("is-invalid"),n=!1),n},edit:function(n){this.subScription=n;this.options=n.options;for(var t=0;t<n.options.length;t++)n.options[t].isSelected&&(this.pricings=n.options[t].pricings);$("#modal-subscription").modal("show")},remove:function(n){if(!this.isSaving)return this.isSaving=!0,$.ajax({type:"POST",url:"/SubScription/Remove?id="+n.userSubScriptionID,context:this,contentType:"application/json",dataType:"json",success:function(t){t.isOk&&(n.isDeleted=!0);this.isSaving=!1},error:function(){this.isSaving=!1}})},recovery:function(n){if(!this.isSaving)return this.isSaving=!0,$.ajax({type:"POST",url:"/SubScription/Recovery?id="+n.userSubScriptionID,context:this,contentType:"application/json",dataType:"json",success:function(t){t.isOk&&(n.isDeleted=!1);this.isSaving=!1},error:function(){this.isSaving=!1}})}}});