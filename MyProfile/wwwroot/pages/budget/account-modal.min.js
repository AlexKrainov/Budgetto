var AccountVue=new Vue({el:"#account-modal-vue",data:{account:{id:undefined,accountType:1,currency:{},currencyID:-1},accountTypes:[],banks:[],flatpickrExpirationDate:null,currencyInfos:Metadata.currencies,isSaving:!1},watch:{},mounted:function(){$.ajax({type:"GET",url:"/Account/GetEnvironment",contentType:"application/json; charset=utf-8",dataType:"json",context:this,success:function(n){return n.isOk&&(this.accountTypes=n.accountTypes,this.banks=n.banks),n},error:function(n,t,i){console.log(i)}})},methods:{edit:function(n){n?this.account=n:(this.account={id:undefined,accountType:1},this.account.currencyID=UserInfo.Currency.ID,this.account.currency=this.currencyInfos[this.currencyInfos.findIndex(n=>n.id==this.account.currencyID)]);let t=GetFlatpickrRuConfig_Month(this.account.expirationDate);this.flatpickrExpirationDate=flatpickr("#expirationDate",t);$("#modal-account").modal("show")},showHide:function(n,t){this.account=n;let i="#account_"+n.id;return ShowLoading(i),$(i).find(".dropdown-menu").removeClass("show"),$.ajax({type:"POST",url:"/Account/ShowHide",contentType:"application/json; charset=utf-8",data:JSON.stringify(this.account),dataType:"json",context:this,success:function(n){return n.isOk&&(this.account.isHide=t),HideLoading(i),n},error:function(n,t,i){console.log(i)}})},save:function(){this.isSaving=!0;$.ajax({type:"POST",url:"/Account/Save",contentType:"application/json; charset=utf-8",data:JSON.stringify(this.account),dataType:"json",context:this,success:function(n){return n.isOk&&(typeof BudgetVue=="object"&&BudgetVue.refresh("onlySummery"),typeof RecordVue=="object"&&RecordVue.recordComponent.loadAccounts(),$("#modal-account").modal("hide")),this.isSaving=!1,n},error:function(n,t,i){this.isSaving=!1;console.log(i)}})},removeOrRecovery:function(n){if(typeof BudgetVue=="object"&&this.account.isDeleted==!1){let n=BudgetVue.accounts.filter(n=>n.isDeleted).length;if(BudgetVue.accounts.length-n<=1){toastr.error("Нельзя удалить все счета, должен оставаться хотябы один.");return}}let t="#account_"+n.id;ShowLoading(t);$(t).find(".dropdown-menu").removeClass("show");this.account=n;this.account.isDeleted=!this.account.isDeleted;$.ajax({type:"POST",url:"/Account/RemoveOrRecovery",contentType:"application/json; charset=utf-8",data:JSON.stringify(this.account),dataType:"json",context:this,success:function(n){if(n.isOk){if(this.account.isDeleted=n.isDeleted,this.account.isDefault=!1,typeof BudgetVue=="object"){let t=BudgetVue.accounts.findIndex(t=>t.id==n.accountIDWithIsDefault);t!=-1&&n.accountIDWithIsDefault!=-1&&(BudgetVue.accounts[t].isDefault=!0)}typeof RecordVue=="object"&&RecordVue.recordComponent.loadAccounts();this.account.isDeleted?toastr.success("Вы успешно удалили счет"):toastr.success("Вы успешно восстановили счет")}return HideLoading("#account_"+this.account.id),n},error:function(n,t,i){toastr.error("Ошибка во время удаления счета");console.log(i)}})},changeCurrency:function(n){this.account.currencyID=n.id;this.account.currency=n;this.$forceUpdate()}}});