var HistoryVue=new Vue({el:"#history-vue",data:{records:[],spendingTotalMoney:0,spendingErningMoney:0,spendingInvestingMoney:0,dateTime:null,dateStart:null,dateEnd:null,searchText:null,sections:[],flatpickrStart:null,flatpickrEnd:null},watch:{searchText:function(n){n&&(n=n.toLocaleLowerCase());for(var t=0;t<this.records.length;t++){let i=this.records[t];i.isShowForFilter=i.sectionName.toLocaleLowerCase().indexOf(n)>=0||i.description&&i.description.toLocaleLowerCase().indexOf(n)>=0||i.areaName.toLocaleLowerCase().indexOf(n)>=0||i.userName&&i.userName.toLocaleLowerCase().indexOf(n)>=0||i.money.toString().indexOf(n)>=0||i.rawData.indexOf(n)>=0}},records:{handler:function(){this.spendingTotalMoney=0;this.spendingErningMoney=0;this.spendingInvestingMoney=0;for(var n=0;n<this.records.length;n++)this.records[n].isDeleted==!1&&(this.records[n].sectionTypeID==1?this.spendingErningMoney+=this.records[n].money*1:this.records[n].sectionTypeID==2?this.spendingTotalMoney+=this.records[n].money*1:this.records[n].sectionTypeID==3&&(this.spendingInvestingMoney+=this.records[n].money*1))},deep:!0}},mounted:function(){$("#history-sections").select2();$("#modalTimeLine").on("hide.bs.modal",function(){$("#historyCollapse").removeClass("show");HistoryVue.flatpickrStart=undefined;HistoryVue.flatpickrEnd=undefined})},methods:{showHistory:function(n,t){return this.dateTime=t,this.unselectAll(),this.loadTimeLine(n)},showLastHistory:function(){this.search()},search:function(){if(this.flatpickrStart!=undefined){let n={sections:$("#history-sections").val(),startDate:moment(this.flatpickrStart.latestSelectedDateObj).format(),endDate:moment(this.flatpickrEnd.latestSelectedDateObj).format()};return this.loadTimeLine(n)}},loadTimeLine:function(n){this.dateStart=n.startDate;this.dateEnd=n.endDate;let t=GetFlatpickrRuConfig(moment(this.dateStart,"YYYY/MM/DD").toDate());this.flatpickrStart=flatpickr("#dateHistoryStart",t);var i=GetFlatpickrRuConfig(moment(this.dateEnd,"YYYY/MM/DD").toDate());return this.flatpickrEnd=flatpickr("#dateHistoryEnd",i),ShowLoading(".records-timeline"),$.ajax({type:"POST",url:"/Budget/LoadingRecordsForTableView",data:JSON.stringify(n),contentType:"application/json",dataType:"json",context:this,success:function(n){this.records=n.data;this.sections=n.sections;$("#history-sections").val(this.sections.filter(n=>n.selected).map(n=>n.id)).trigger("change");HideLoading(".records-timeline");$("#modalTimeLine").modal("show")}})},selectAll:function(){$("#history-sections").val(this.sections.map(n=>n.id)).trigger("change")},unselectAll:function(){$("#history-sections").val(null).trigger("change")},closeTimeline:function(){this.clearAllStyle()},getCurrencyValue:function(n){let t=new Intl.NumberFormat(UserInfo.Currency.SpecificCulture,{style:"currency",currency:UserInfo.Currency.CodeName}).format(n.money);if(UserInfo.Currency.ID!=n.currencyID)try{t+=" ("+new Intl.NumberFormat(n.currencySpecificCulture,{style:"currency",currency:n.currencyCodeName}).format(CalculateExpression(n.tag))+")"}catch(i){}return t},descriptionBuilder:function(n){return TagBuilder.toDescription(n)},GetDateByFormat:function(n,t){return GetDateByFormat(n,t)},add:function(){$("#modalTimeLine").modal("hide");setTimeout(RecordVue.showModal,750,this.dateTime,"BudgetVue.refreshAfterChangeRecords")},edit:function(n){$("#modalTimeLine").modal("hide");setTimeout(RecordVue.editByElement,750,n,BudgetVue.refreshAfterChangeRecords)},remove:function(n){return ShowLoading("#record_"+n.id),$.ajax({type:"POST",url:"/Budget/RemoveRecord",data:JSON.stringify(n),context:n,contentType:"application/json",dataType:"json",success:function(t){n.isDeleted=t.isOk;HideLoading("#record_"+n.id);BudgetVue.refreshAfterChangeRecords(t.dateTimeOfPayment)}})},recovery:function(n){return ShowLoading("#record_"+n.id),$.ajax({type:"POST",url:"/Budget/RecoveryRecord",data:JSON.stringify(n),context:n,contentType:"application/json",dataType:"json",success:function(t){n.isDeleted=!t.isOk;HideLoading("#record_"+n.id);BudgetVue.refreshAfterChangeRecords(t.dateTimeOfPayment)}})}}});