var BudgetVue=new Vue({el:"#budget-vue",data:{periodType:BudgetMethods.periodType,budgetDate:null,budgetYear:null,templateID:null,template:{},queueNumber:0,rows:[],footerRow:[],column:{},flatpickr:{},records:[],tableAjax:null,dataTable:null,excelDataTable:null,pageViewSettings:{version:1,isTableViewCompact:!1},isGenerateExcel:!1,totalChartsAjax:null,earningData:{},earningChart:undefined,spendingData:{},spendingChart:undefined,investingData:{},investingChart:undefined,limitsAjax:null,limitsChartsData:[],limitsCharts:[],goalsAjax:null,goalChartsData:[],goalCharts:[],bigChartsAjax:null,bigChartsData:[],bigCharts:[],bigChartHeight:310,summary:{isShow:BudgetMethods.isShowSummary,earningsPerHour:{},expensesPerDay:{},cashFlow:{},allAccountsMoney:{},allSubScriptionPrice:{}},chashFlowChart:undefined,summaryAjax:null,accounts:[],accountsAjax:null,listReRender:!0,lists:[],toDoListAjax:null,refreshEditItem:!0,progresses:[],progressAjax:null,isLoading:!1,counter:-4999},watch:{},mounted:BudgetMethods.mounted,methods:{load:BudgetMethods.load,changeView:BudgetMethods.changeView,loadTotalCharts:BudgetMethods.loadTotalCharts,initTotalCharts:function(){this.earningChart&&this.earningChart.destroy();this.earningChart=new Chart(document.getElementById("earningChart").getContext("2d"),{type:"line",data:{datasets:[{data:this.earningData.data,borderWidth:1,backgroundColor:"rgba(2, 188, 119, .2)",borderColor:"rgba(2, 188, 119, 1)",pointBorderColor:"rgba(0,0,0,0)",pointRadius:1,lineTension:0}],labels:this.earningData.labels},options:{scales:{xAxes:[{display:!1}],yAxes:[{display:!1}]},legend:{display:!1},tooltips:{enabled:!1},responsive:!1,maintainAspectRatio:!1}});this.spendingChart&&this.spendingChart.destroy();this.spendingChart=new Chart(document.getElementById("spendingChart").getContext("2d"),{type:"line",data:{datasets:[{data:this.spendingData.data,borderWidth:1,backgroundColor:"rgba(217, 83, 79, .2)",borderColor:"rgba(217, 83, 79, 1)",pointBorderColor:"rgba(0,0,0,0)",pointRadius:1,lineTension:0}],labels:this.spendingData.labels},options:{scales:{xAxes:[{display:!1}],yAxes:[{display:!1}]},legend:{display:!1},tooltips:{enabled:!1},responsive:!1,maintainAspectRatio:!1}});this.investingChart=new Chart(document.getElementById("investmentsChart").getContext("2d"),{type:"line",data:{datasets:[{data:this.investingData.data,borderWidth:1,backgroundColor:"rgba(136, 151, 170, .2)",borderColor:"rgba(136, 151, 170, 1)",pointBorderColor:"rgba(0,0,0,0)",pointRadius:1,lineTension:0}],labels:this.investingData.labels},options:{scales:{xAxes:[{display:!1}],yAxes:[{display:!1}]},legend:{display:!1},tooltips:{enabled:!1},responsive:!1,maintainAspectRatio:!1}});setTimeout(this.resizeTotalCharts,50)},resizeTotalCharts:function(){this.earningChart&&this.earningChart.resize();this.spendingChart&&this.spendingChart.resize();this.investingChart&&this.investingChart.resize();this.refrehHeaderTable()},loadLimitCharts:BudgetMethods.loadLimitCharts,initLimitCharts:function(){for(var n=0;n<this.limitsChartsData.length;n++){let t=this.limitsChartsData[n];this.limitsCharts[n]&&this.limitsCharts[n].destroy();let i=["#4CAF50","#ededed"],r=["#4CAF50","#ededed"];t.percent1>85?(i=["#d9534f","#ededed"],r=["#d9534f","#ededed"]):t.percent1>65&&(i=["#FFD950","#ededed"],r=["#FFD950","#ededed"]);this.limitsCharts[n]=new Chart(document.getElementById(t.chartID).getContext("2d"),{type:"doughnut",data:{datasets:[{data:[t.percent1,t.percent2],backgroundColor:i,hoverBackgroundColor:r,borderWidth:0}]},options:{scales:{xAxes:[{display:!1}],yAxes:[{display:!1}]},legend:{display:!1},tooltips:{enabled:!1},cutoutPercentage:94,responsive:!1,maintainAspectRatio:!1}})}this.resizeLimitCharts();this.resizeLimitCharts()},resizeLimitCharts:function(){for(var n=0;n<this.limitsCharts.length;n++)this.limitsCharts[n]&&this.limitsCharts[n].resize();this.refrehHeaderTable()},hideLimit:function(n){return ShowLoading("#limit_"+n),$.ajax({type:"GET",url:"/Limit/ToggleLimit?id="+n+"&periodType="+this.periodType,contentType:"application/json",dataType:"json",context:n,success:function(n){HideLoading("#limit_"+this);(n.isOk=!0)&&BudgetVue.limitsChartsData.splice(BudgetVue.limitsChartsData.findIndex(n=>n.id==this),1)},error:function(){HideLoading("#limit_"+this)}})},getSectionsTitleForLimit:function(n){if(n.length>0){let i="";for(var t=0;t<n.length;t++)i+=`<li>${n[t].name}</li>`;return"<ul class='my-1 pl-3'>"+i+"<\/ul>"}return""},loadGoalCharts:BudgetMethods.loadGoalCharts,OLD_initGoalCharts:function(){for(var n=0;n<this.goalChartsData.length;n++){let t=this.goalChartsData[n];this.goalCharts[n]&&this.goalCharts[n].destroy();let i=["#4CAF50","#ededed"],r=["#4CAF50","#ededed"];t.percent<0&&(i=["#d9534f","#ededed"],r=["#d9534f","#ededed"]);this.goalCharts[n]=new Chart(document.getElementById(t.chartID).getContext("2d"),{type:"doughnut",data:{datasets:[{data:[t.percent,t.percent2],backgroundColor:i,hoverBackgroundColor:r,borderWidth:0}]},options:{scales:{xAxes:[{display:!1}],yAxes:[{display:!1}]},legend:{display:!1},tooltips:{enabled:!1},cutoutPercentage:94,responsive:!1,maintainAspectRatio:!1}})}setTimeout(this.resizeGoalCharts,10)},OLD_resizeGoalCharts:function(){for(var n=0;n<this.goalCharts.length;n++)this.goalCharts[n]&&this.goalCharts[n].resize();this.refrehHeaderTable()},addGoalMoney:function(n){GoalAddMoneyVue.addMoney(n)},hideGoal:function(n){return ShowLoading("#goal_"+n),$.ajax({type:"GET",url:"/Goal/ToggleGoal?id="+n+"&periodType="+this.periodType,contentType:"application/json",dataType:"json",context:n,success:function(n){HideLoading("#goal_"+this);(n.isOk=!0)&&BudgetVue.goalChartsData.splice(BudgetVue.goalChartsData.findIndex(n=>n.id==this),1)},error:function(){HideLoading("#goal_"+this)}})},loadBigCharts:BudgetMethods.loadBigCharts,initBigChartCharts:function(){for(var n=0;n<this.bigChartsData.length;n++){let t=this.bigChartsData[n],i=null,r=themeSettings.isDarkStyle()?"#fff":"#aaa";this.bigCharts[n]&&this.bigCharts[n].destroy();switch(t.chartTypeCodeName){case"line":case"bar":i={title:{display:!1},scales:{xAxes:[{ticks:{fontColor:r}}],yAxes:[{ticks:{callback:function(n){return new Intl.NumberFormat(UserInfo.Currency.SpecificCulture,{style:"currency",currency:UserInfo.Currency.CodeName}).format(n).split(",")[0]+" ₽"},fontColor:r,beginAtZero:!0}}]},tooltips:{callbacks:{label:function(n){return new Intl.NumberFormat(UserInfo.Currency.SpecificCulture,{style:"currency",currency:UserInfo.Currency.CodeName}).format(n.value).split(",")[0]+" ₽"}}},legend:{display:t.chartTypesEnum==1||t.chartTypesEnum==6,fontColor:r},responsive:!1,maintainAspectRatio:!1};break;case"doughnut":case"pie":i={title:{display:!1,text:t.name},tooltips:{callbacks:{label:function(n,t){let i="",r="";try{i=t.labels[n.index];r=t.datasets[0].data[n.index]}catch(u){console.log(u)}return`${i}: ${new Intl.NumberFormat(UserInfo.Currency.SpecificCulture,{style:"currency",currency:UserInfo.Currency.CodeName}).format(r).split(",")[0]} ₽`}}}}}this.bigCharts[n]=new Chart(document.getElementById(t.chartID),{type:t.chartTypeCodeName,data:{labels:t.labels,datasets:t.dataSets},options:i})}this.resizeBigCharts()},resizeBigCharts:function(){let n=0;for(var t=0;t<this.bigCharts.length;t++){let i=this.bigCharts[t];i&&(i.resize(),n=i.height)}n<300?this.bigChartHeight=310:n>=300&&n<=450?this.bigChartHeight=370:n>450&&(this.bigChartHeight=600);this.refrehHeaderTable()},toggleBigChart:function(n){return ShowLoading("#chart_"+n),$.ajax({type:"GET",url:"/Chart/ToggleChart?id="+n+"&periodType="+this.periodType+"&isBudgetPage=true",contentType:"application/json",dataType:"json",context:n,success:function(n){HideLoading("#chart_"+this);(n.isOk=!0)&&BudgetVue.bigChartsData.splice(BudgetVue.bigChartsData.findIndex(n=>n.id==this),1)},error:function(){HideLoading("#chart_"+this)}})},loadSummaries:BudgetMethods.loadSummaries,initSummaryCharts:function(){this.summary.cashFlow.isShow&&this.summary.cashFlow.isChart&&(this.chashFlowChart&&this.chashFlowChart.destroy(),this.chashFlowChart=new Chart(document.getElementById("chashFlowChart").getContext("2d"),{type:"line",data:{datasets:[{data:this.summary.cashFlow.data,borderWidth:1,backgroundColor:"rgba(38, 180, 255, .2)",borderColor:"rgba(38, 180, 255, 1)",pointBorderColor:"rgba(0,0,0,0)",pointRadius:1,lineTension:0}],labels:this.summary.cashFlow.labels},options:{scales:{xAxes:[{display:!1}],yAxes:[{display:!1}]},legend:{display:!1},tooltips:{enabled:!1},responsive:!1,maintainAspectRatio:!1}}));setTimeout(this.resizeSummaryCharts,50)},resizeSummaryCharts:function(){this.chashFlowChart&&this.chashFlowChart.resize();this.refrehHeaderTable()},loadAccounts:BudgetMethods.loadAccounts,editMainAccount:function(n,t){n==undefined?MainAccountVue.edit(undefined,t):MainAccountVue.edit(JSCopyObject(n),t)},editAccount:function(n,t){n==undefined?AccountVue.edit(undefined,t):AccountVue.edit(JSCopyObject(n),t)},removeOrRecoveryAccount:function(n){AccountVue.removeOrRecovery(n)},removeOrRecoveryMainAccount:function(n){MainAccountVue.removeOrRecovery(n)},showHideAccount:function(n,t){return AccountVue.showHide(n,t)},transferMoney:function(n){let t=[];for(var i=0;i<this.accounts.length;i++)t=t.concat(this.accounts[i].accounts);AccountTransferVue.transferMoney(t,n)},showHideAccounts:function(n,t){for(var i=0;i<n.accounts.length;i++)n.accounts[i].isHideCurrentAccount!=t&&(n.accounts[i].isHideCurrentAccount=t,AccountVue.showHide(n.accounts[i],t))},loadToDoLists:BudgetMethods.loadToDoLists,afterLoadLists:function(){this.$nextTick(()=>{let t=document.querySelectorAll(".perfect-scroll");for(var n=0;n<t.length;n++)new PerfectScrollbar(t[n])})},addListItem:function(n){if(n.items||(n.items=[]),n.editItem.text&&n.editItem.text.length!=0)$("#edititem_list_"+n.id+" input[name=input-text]").removeClass("is-invalid");else return $("#edititem_list_"+n.id+" input[name=input-text]").addClass("is-invalid"),!1;if(n.editItem.id){let t=n.items.findIndex(t=>t.id==n.editItem.id);t!=-1&&(n.items[t].text=n.editItem.text)}else n.items.push({id:this.counter,text:n.editItem.text,isDone:!1,isDeleted:!1,order:n.items.length+1}),this.counter++;n.editItem={id:0,text:""};this.saveList(n);this.$nextTick(()=>{$("#list_"+n.id+" .perfect-scroll").scrollTop($("#list_"+n.id+" .perfect-scroll").prop("scrollHeight"))})},editListItem:function(n,t){n.editItem=t;$("#edititem_list_"+n.id+" input[name=input-text]").focus()},keyItemPress:function(n,t){n.keyCode==13&&this.addListItem(t)},saveList:function(n){for(var t,r=$("#list_"+n.id+" div.todo-item"),i=0;i<r.length;i++){let t=$(r[i]).attr("item-id")*1,u=n.items.findIndex(n=>n.id==t);n.items[u].order=i}if(BudgetVue.queueNumber+=1,t==undefined)t=[n];else{let i=t.findIndex(t=>t.id==n.id);i==-1?t.push(n):t[i]=n}setTimeout(function(){if(BudgetVue.queueNumber==1){BudgetVue.queueNumber=0;for(var n=0;n<t.length;n++)$.ajax({type:"POST",url:"/ToDoList/EditList",data:JSON.stringify(t[n]),context:BudgetVue,contentType:"application/json",dataType:"json",success:function(n){if(n.isOk){let t=this.lists.findIndex(t=>t.id==n.list.id);this.lists[t]=n.list}t=undefined;BudgetVue.$forceUpdate()},error:function(){}})}else BudgetVue.queueNumber-=1},3e3)},remvoeList:function(n){let t=[n];return ShowLoading("#list_"+n.id),$.ajax({type:"POST",url:"/ToDoList/RemoveList",data:JSON.stringify(t),context:{$this:this,list:n},contentType:"application/json",dataType:"json",success:function(n){n.isOk&&(this.list.isDeleted=!0);HideLoading("#list_"+this.list.id)},error:function(){HideLoading("#list_"+this.list.id)}})},recoveryList:function(n){return ShowLoading("#list_"+n.id),$.ajax({type:"GET",url:"/ToDoList/Recovery?listID="+n.id,context:n,contentType:"application/json",dataType:"json",success:function(n){this.isDeleted=!n.isOk;HideLoading("#list_"+this.id)}})},hideList:function(n){return ShowLoading("#list_"+n.id),$.ajax({type:"GET",url:"/ToDoList/HideList?listID="+n.id+"&periodType="+this.periodType,context:{$this:this,list:n},contentType:"application/json",dataType:"json",success:function(){HideLoading("#list_"+this.list.id);let n=this.$this.lists.findIndex(n=>n.id==this.list.id);this.$this.lists.splice(n,1)}})},loadProgress:BudgetMethods.loadProgress,getProgressCompleteStyle:function(n){return n<=this.progresses.length-2&&this.progresses[n].isComplete&&this.progresses[n+1].isComplete?"progress-complete":""},refresh:function(n){if((n==undefined||n=="onlyTable"||n=="runtimeData"||n=="all"||n=="only-progress")&&this.templateID!="-1"&&(this.isLoading=!0,ShowLoading(".table-container"),this.dataTable&&(this.dataTable=undefined,$("#table").DataTable().destroy()),this.load().then(function(){HideLoading(".table-container");try{BudgetVue.initTable()}catch(n){console.log(n);BudgetVue.template={};BudgetVue.footerRow=[];BudgetVue.row=[];BudgetVue.refresh("onlyTable")}this.isLoading=!1})),n=="onlyTable")return!1;if(n=="only-progress")return this.loadProgress(),!1;if(n=="runtimeData")return this.loadBigCharts(),this.loadTotalCharts(),this.loadLimitCharts(),this.loadAccounts(),this.loadSummaries(),!1;if(n=="onlyGoal"){ShowLoading("#goal-contrainer");this.loadGoalCharts().then(function(){HideLoading("#goal-contrainer")});return}if(n=="onlySummery"){this.loadAccounts();this.loadSummaries();return}this.loadBigCharts();this.loadTotalCharts();this.loadLimitCharts();this.loadGoalCharts();this.loadAccounts();this.loadSummaries();this.loadToDoLists();this.loadProgress()},refreshAfterChangeRecords:function(n){let t=moment(n);if(this.periodType==PeriodTypeEnum.Month){let n=moment(this.budgetDate,"YYYY/MM/DD");if(t.get("month")==n.get("month")&&t.get("year")==n.get("year"))return this.refresh("runtimeData")}else if(this.periodType==PeriodTypeEnum.Year&&t.get("year")==this.budgetYear)return this.refresh("runtimeData");return!1},resizeAll:function(){this.resizeTotalCharts();this.resizeLimitCharts();this.resizeBigCharts();this.resizeSummaryCharts()},refrehHeaderTable:function(){this.dataTable&&this.dataTable.fixedHeader&&this.dataTable.fixedHeader.adjust();$('[data-toggle="tooltip"]').tooltip()},initTable:function(){this.dataTable=$("#table").DataTable({columnDefs:[{targets:"_all",className:"column-min-width",orderDataType:"dom-text-numeric",type:"num"},],colReorder:{realtime:!1}});this.dataTable.on("column-reorder",this.moveColumn);$.fn.dataTable.ext.order["dom-text-numeric"]=function(n,t){return this.api().column(t,{order:"index"}).nodes().map(function(n){return $(n).find("span[data-value]").data("value")})};setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},1e3)},moveColumn:function(){BudgetVue.queueNumber+=1;setTimeout(function(){if(BudgetVue.queueNumber==1){BudgetVue.queueNumber=0;let n=[];$("#table th").each(function(){let t=$(this);n.push({id:t.data("column-id"),newOrder:t.data("column-index"),oldOrder:t.data("column-order")})});$.ajax({type:"POST",url:"/Budget/TemplateChangeColumns",contentType:"application/json",data:JSON.stringify({listOrder:n,templateID:BudgetVue.template.id}),dataType:"json",success:function(){toastr.success("Изменения в шаблоне сохранены")}})}else BudgetVue.queueNumber-=1},1500)},toExcel:function(){this.isGenerateExcel=!0;BudgetVue.excelDataTable=$("#excel-table").DataTable({dom:"Bfrtip",buttons:["excelHtml5"],retrieve:!0});setTimeout(function(){$(".buttons-excel").click();BudgetVue.isGenerateExcel=!1;setTimeout(function(){BudgetVue.excelDataTable.destroy()},2e3)},100)},getCellContent:function(n,t,i){let r=n.reminders&&n.reminders.some(n=>n.isDone)?"reminder-is-done":"";return this.periodType==PeriodTypeEnum.Month?`<div class="cell-head">${this.getCellActions(n,t,i)+this.getCellValue(n,t,i)}</div>
                    <div class="cell-footer mt-1">
                        <span class="cell-reminder-icons ${r}"
                                onclick="ReminderVue.showReminders('${n.currentDate}')">${this.getRemindersIcons(n)}</span>
                        <span class="cell-section-icons"></span>
                    </div>`:`<div class="cell-head">${this.getCellActions(n,t,i)+this.getCellValue(n,t,i)}</div>
                    <div class="cell-footer mt-1"><span class="cell-reminder-icons"></span><span class="cell-section-icons"></span></div>`},getCellFooterContent:function(n,t){return this.getCellFooterActions(t)+this.getCellValue(n,t)},getCellActions:function(n,t,i){return this.periodType==PeriodTypeEnum.Month?n.templateColumnType==2?`
                    <span class="float-left cell-actions">
                        <i class="ion ion-md-add add-cell-action" onclick="RecordVue.showModal('${n.currentDate}', 'BudgetVue.refreshAfterChangeRecords')" title="Добавить запись" ></i>
                        <i class="fas fa-history show-history-cell-action pl-1" onclick="BudgetVue.showHistory(${i}, ${t},'${n.currentDate}', event)" title="Посмотреть историю"></i>
                        <i class="remind-cell-action">+<i class="ion ion-ios-alarm text-big" onclick="ReminderVue.addReminders('${n.currentDate}')" title="Добавить напоминание"></i></i>
                    </span>`:`
                    <span class="float-left cell-actions">
                        <i class="fas fa-history show-history-cell-action pl-1" onclick="BudgetVue.showHistory(${i}, ${t},'${n.currentDate}', event)" title="Посмотреть историю"></i>
                    </span>`:`
                    <span class="float-left cell-actions">
                        <i class="fas fa-history show-history-cell-action pl-1" onclick="BudgetVue.showHistory(${i}, ${t},'${n.currentDate}', event)"></i>
                    </span>`},getCellFooterActions:function(n){return`
                <span class="float-left cell-actions">
                    <i class="fas fa-history show-history-cell-action pl-1" onclick="BudgetVue.clickFooterCell(${n})" title="Посмотреть историю"></i>
                </span>`},getCellValue:function(n,t,i){if(n.value.indexOf(",")){let r=n.value.split(","),u=` data-type="${n.templateColumnType}" data-value='${n.naturalValue}'`;return i>=0?r.length==2?`<span ${u} onclick="BudgetVue.showHistory(${i}, ${t},'${n.currentDate}', event)" title="Посмотреть историю"> 
                                ${r[0]}
                                <span class="money-muted">,${r[1]}</span>
                            </span> `:`<span ${u} onclick="BudgetVue.showHistory(${i}, ${t},'${n.currentDate}', event)" title="Посмотреть историю"> ${n.value}</span>`:r.length==2?`<span ${u} onclick="BudgetVue.clickFooterCell(${t})" class="font-weight-semibold"> 
                                ${r[0]}
                                <span class="money-muted">,${r[1]}</span>
                            </span> `:`<span ${u} onclick="BudgetVue.clickFooterCell(${t})" class="font-weight-semibold"> ${n.value}</span>`}return`<span ${generalValue} onclick="BudgetVue.showHistory(${i}, ${t},'${n.currentDate}', event)" title="Посмотреть историю"> ${n.value}</span>`},getHeaderTitle:function(n){if(n.templateColumnType==1){let i="";for(var t=0;t<n.templateBudgetSections.length;t++)i+=`<li>${n.templateBudgetSections[t].sectionName}</li>`;return"<ul class='my-1 pl-3'>"+i+"<\/ul>"}return""},getRemindersIcons:function(n){if(n.templateColumnType==2){let i=``;for(var t=0;t<n.reminders.length;t++){let r=n.reminders[t],f="",u="",e="";r.isRepeat&&(u='<i class="fas fa-sync" style="font-size: 8px; color: gray; padding-top: -3px; position: absolute;"><\/i>');r.count>1&&(f=r.count,r.isRepeat&&(u="",e='<i class="fas fa-sync" style="font-size: 8px; color: gray; padding-top: -3px;"><\/i>'));i+=`<span class="mr-1"><i class="${r.cssIcon}" title="${r.titles}"></i>${u}<span class="reminder-count">${f}</span>${e}</span>`}return i}return""},mouseenterCell:function(n){if(n.target.nodeName=="TD"&&n.target.classList.contains("show-actions")==!1){n.target.classList.add("show-actions");return}},mouseleaveCell:function(n){if(n.target.nodeName=="TD"&&n.target.classList.contains("show-actions")){n.target.classList.remove("show-actions");return}},showHistory:function(n,t,i,r){let f=[];if(this.template.columns[t].templateColumnType==1)f=this.template.columns[t].templateBudgetSections.map(n=>n.sectionID),this.stylingClickedCells(r,"td");else if([2,3,4,7].indexOf(this.template.columns[t].templateColumnType)>=0){for(var e=0;e<this.template.columns.length;e++)f=f.concat(this.template.columns[e].templateBudgetSections.map(n=>n.sectionID));this.stylingClickedCells(r,"tr")}else return;let u={sections:f,isSection:!0};return this.periodType==PeriodTypeEnum.Month?(u.startDate=moment(this.budgetDate,"YYYY/MM/DD").add(n,"days").format(),u.endDate=moment(this.budgetDate,"YYYY/MM/DD").add(n+1,"days").add(-1,"minutes").format()):this.periodType==PeriodTypeEnum.Year&&(u.startDate=moment(i,"YYYY/MM/DD").format(),u.endDate=moment(i,"YYYY/MM/DD").endOf("month").format()),HistoryVue.showHistory(u,i)},showAllHistory:function(){let n={sections:RecordVue.recordComponent.sectionComponent.sections.map(n=>n.id),isSection:!0};return this.periodType==PeriodTypeEnum.Month?(n.startDate=moment(this.budgetDate).format(),n.endDate=moment(this.budgetDate).endOf("month").format()):this.periodType==PeriodTypeEnum.Year&&(n.startDate=`${this.budgetYear}-01-01T00:00:01+00:00`,n.endDate=`${this.budgetYear}-12-31T23:59:59+00:00"`),HistoryVue.showHistory(n)},showLimitHistory:function(n){let i=this.limitsChartsData.findIndex(t=>t.id==n),t={sections:this.limitsChartsData[i].sections.map(n=>n.id),isSection:!0};return this.periodType==PeriodTypeEnum.Month?(t.startDate=moment(this.budgetDate).format(),t.endDate=moment(this.budgetDate).endOf("month").format()):this.periodType==PeriodTypeEnum.Year&&(t.startDate=`${this.budgetYear}-01-01T00:00:01+00:00`,t.endDate=`${this.budgetYear}-12-31T23:59:59+00:00"`),HistoryVue.showHistory(t)},clickFooterCell:function(n){let t={sections:[]};if(this.template.columns[n].templateColumnType==TemplateColumnTypeEnum.BudgetSection)t.sections=this.template.columns[n].templateBudgetSections.map(n=>n.sectionID),this.stylingClickedCells(event,"td_s",n);else if(this.template.columns[n].templateColumnType==TemplateColumnTypeEnum.DaysForMonth||this.template.columns[n].templateColumnType==TemplateColumnTypeEnum.MonthsForYear)t.sections=this.template.columns.map(n=>n.templateBudgetSections.map(n=>n.sectionID)).flat(),this.stylingClickedCells(event,"table",n);else return null;return this.periodType==PeriodTypeEnum.Month?(t.startDate=moment(this.budgetDate).format(),t.endDate=moment(this.budgetDate).endOf("month").format()):this.periodType==PeriodTypeEnum.Year&&(t.startDate=`${this.budgetYear}-01-01T00:00:01+00:00`,t.endDate=`${this.budgetYear}-12-31T23:59:59+00:00"`),HistoryVue.showHistory(t)},stylingClickedCells:function(n,t,i){this.clearAllStyle();t=="td"?$(n.target).closest("td").addClass("table-primary"):t=="tr"?$(n.target).closest("tr").addClass("table-primary"):t=="td_s"?$("#table td:nth-child("+ ++i+")").addClass("table-primary"):t=="table"&&$("#table td").addClass("table-primary")},clearAllStyle:function(){let t=[...document.getElementsByClassName("table-primary")];for(var n=0;n<t.length;n++)t[n].classList.remove("table-primary")},savePageSettings:function(){localStorage.setItem("pageViewSettings",JSON.stringify(this.pageViewSettings))},savePageSettings:function(){localStorage.setItem("pageViewSettings",JSON.stringify(this.pageViewSettings))},getPageSettings:function(){let n=localStorage.getItem("pageViewSettings");if(n!=null)try{n=JSON.parse(n);this.pageViewSettings=n}catch(t){}},getSectionsTitle:function(n,t){let i="";if(t==SectionTypeEnum.Earnings?i+="Доходы за":t==SectionTypeEnum.Investments?i+="Пополнения за ":t==SectionTypeEnum.Spendings&&(i+="Расходы за "),this.periodType==PeriodTypeEnum.Month?i+=" месяц ":this.periodType==PeriodTypeEnum.Year&&(i+=" год "),i+=t==SectionTypeEnum.Investments?"по счетам: ":"по категориям: ",n&&n.length>0){let t="";for(var r=0;r<n.length;r++)t+=`<li>${n[r].name}</li>`;return i+"<ul class='my-1 pl-3'>"+t+"<\/ul>"}return i},getCurrencyValue:function(n,t){return t==undefined||t.codeName=="RUB"?new Intl.NumberFormat(UserInfo.Currency.SpecificCulture,{style:"currency",currency:UserInfo.Currency.CodeName}).format(n).split(",")[0]+" ₽":new Intl.NumberFormat(t.specificCulture,{style:"currency",currency:t.codeName}).format(n)},getDateByFormat:function(n,t){return GetDateByFormat(n,t)}}});