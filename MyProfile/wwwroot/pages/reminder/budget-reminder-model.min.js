var ReminderVue=new Vue({el:"#reminder-vue",data:{reminders:[],reminder:{isRepeat:!1},dateTime:null,dateTimeFinish:null,month:-1,year:-1,flatpickrReminder:{},searchText:null,isSaving:!1,isShowModal:!1,isNew:!0},watch:{"reminder.isRepeat":function(){this.reminder.isRepeat&&this.reminder.repeatEvery==undefined&&(this.reminder.repeatEvery="Month")}},mounted:function(){},methods:{showReminders:function(n){return this.dateTime=n,this.month=null,this.year=null,this.dateTimeFinish=null,this.close(),this.loadTimeLine(n)},showRemindersByPeriod:function(n,t){return this.dateTime=null,this.month=n,this.year=t,this.close(),this.loadTimeLine()},addReminders:function(n){return this.dateTime=n,this.edit(),this.loadTimeLine(n)},loadTimeLine:function(){return $.ajax({type:"GET",url:"/Reminder/LoadReminders?currentDate="+this.dateTime+"&month="+this.month+"&year="+this.year,contentType:"application/json",dataType:"json",context:this,success:function(n){this.month=null;this.year=null;this.dateTime=n.currentDate;this.dateTimeFinish=n.dateTimeFinish;this.reminders=n.data;$("#modalReminderTimeLine").modal("show")}})},chooseReminderIcon:function(n){if($(".reminder-icons i").removeClass("active"),!n)return!0;let t=n.replace(" ",".");$(".reminder-icons i."+t).addClass("active");this.reminder.cssIcon=n},closeTimeline:function(){this.clearAllStyle()},edit:function(n){if(this.isShowModal=!0,this.reminder.id=-1,this.reminder.title=null,this.reminder.description=null,this.reminder.cssIcon=null,this.reminder.isRepeat=!1,this.reminder.repeatEvery=null,n){this.isNew=!1;this.reminder=JSCopyObject(n);let t=GetFlatpickrRuConfigWithTime(this.reminder.dateReminder);this.flatpickrReminder=flatpickr("#reminderDateReminder",t)}else{this.isNew=!0;this.reminder.dateReminder=this.dateTime;let n=GetFlatpickrRuConfigWithTime(this.dateTime);this.flatpickrReminder=flatpickr("#reminderDateReminder",n)}this.chooseReminderIcon(this.reminder.cssIcon)},close:function(){this.isShowModal=!1;this.reminder={isRepeat:!1};this.chooseReminderIcon()},save:function(){return this.checkValid()==!1?!1:(this.isSaving=!0,$.ajax({type:"POST",url:"/Reminder/Edit",data:JSON.stringify(this.reminder),context:this,contentType:"application/json",dataType:"json",success:function(n){if(n.isOk){if(this.reminder.id>0){let t=this.reminders.findIndex(t=>t.id==n.data.id);this.reminders[t]=n.data}else this.reminders.push(n.data);BudgetVue.refresh("onlyTable");this.close()}this.isSaving=!1},error:function(n){console.log(n);this.isSaving=!1}}))},checkValid:function(){let n=!0;$("#reminderTitle, #reminderDateReminder").removeClass("is-invalid");this.reminder.title&&this.reminder.title.length>0||(n=!1,$("#reminderTitle").addClass("is-invalid"));let t=this.reminder.title;return t=t?t.replaceAll(" ",""):"",t.length==0?(n=!1,$("#reminderTitle").addClass("is-invalid")):$("#reminderTitle").removeClass("is-invalid"),this.reminder.cssIcon&&this.reminder.cssIcon.length>0?$("#reminderIcons").css("display","none"):(n=!1,$("#reminderIcons").css("display","block")),this.reminder.dateReminder&&this.reminder.dateReminder.length>0||(n=!1,$("#reminderDateReminder").addClass("is-invalid")),this.reminder.isRepeat&&this.reminder.repeatEvery==null?($("#repeatType").addClass("is-invalid"),n=!1):$("#repeatType").removeClass("is-invalid"),n},remove:function(n){if(n.isWasRepeat&&n.isRepeat==!1){toastr.warning("Внимание! Если вы удалите это напоминание, удалится вся цепочка напоминаний.");n.isWasRepeat=!1;return}return ShowLoading("#reminder_"+n.id),$.ajax({type:"POST",url:"/Reminder/Remove",data:JSON.stringify(n),context:this,contentType:"application/json",dataType:"json",success:function(t){n.isDeleted=t.isDeleted;ReminderVue.$forceUpdate();this.reminder.id==n.id&&this.close();HideLoading("#reminder_"+n.id);BudgetVue.refresh("onlyTable")}})},recovery:function(n){return ShowLoading("#reminder_"+n.id),$.ajax({type:"POST",url:"/Reminder/Recovery",data:JSON.stringify(n),context:n,contentType:"application/json",dataType:"json",success:function(t){n.isDeleted=!t.isRecovery;HideLoading("#reminder_"+n.id);BudgetVue.refresh("onlyTable")}})},GetDateByFormat:function(n,t){return GetDateByFormat(n,t)}}});