var HistoryVue=new Vue({el:"#history-vue",data:{searchText:null,sections:[],userTags:[],filter:{isSection:!0,Count:0,isAmount:!0,isConsiderCollection:!1,isCount:!1,Year:moment().get("year"),sections:[],tags:[],startDate:null,endDate:null}},watch:{searchText:function(n){this.historyComponent.searchText=n}},computed:{historyComponent:function(){return this.$children[1]}},mounted:function(){setTimeout(function(){HistoryVue.sections=JSCopyArray(RecordVue.recordComponent.sectionComponent.sections);HistoryVue.userTags=JSCopyArray(RecordVue.recordComponent.userTags);HistoryVue.tagify=new Tagify(document.querySelector('input[name="tags"]'),{whitelist:HistoryVue.userTags,enforceWhitelist:!0,delimiters:null,dropdown:{maxItems:20,classname:"tags-look",enabled:0,closeOnSelect:!1},callbacks:{add:HistoryVue.addTag,remove:HistoryVue.removeTag}});setTimeout(HistoryVue.unselectAllTags,100);HistoryVue.sections.length==0&&(console.log("TEST"),$.ajax({type:"GET",url:"/Section/GetSectins",data:null,contentType:"application/json; charset=utf-8",dataType:"json",context:this,success:function(n){return n.isOk&&(HistoryVue.sections=n.sections),n},error:function(n,t,i){console.log(i)}},this));let n=moment().startOf("month"),t=moment();$("#daterange").daterangepicker(GetDateRangePickerRuConfig(n,t),HistoryVue.setDateRange);HistoryVue.setDateRange(n,t);document.location.href.toLocaleLowerCase().indexOf("history/records")>=0&&HistoryVue.search()},1e3);$("#modalTimeLine").on("hide.bs.modal",function(){$("#historyCollapse").removeClass("show")})},methods:{showHistory:function(n,t){this.dateTime=t;this.unselectAll();for(var i=0;i<this.sections.length;i++)this.sections[i].isSelected=n.sections.some(n=>n==this.sections[i].id);this.filter.startDate=n.startDate;this.filter.endDate=n.endDate;let r=moment(n.startDate),u=moment(n.endDate);$("#daterange").daterangepicker(GetDateRangePickerRuConfig(r,u),HistoryVue.setDateRange);HistoryVue.setDateRange(r,u);this.search()},showLastHistory:function(){$("#modal-record").hasClass("show")==!1&&this.search()},search:function(){var n=$("#daterange").data("daterangepicker");return this.filter.sections=this.sections.filter(n=>n.isSelected).map(n=>n.id),this.filter.tags=this.userTags.filter(n=>n.isShow==!1).map(n=>n.id),this.filter.startDate=n.startDate.format(),this.filter.endDate=n.endDate.format(),this.historyComponent.loadHistory(this.filter)},setDateRange:function(n,t){$("#daterange span").html(n.format("D MMMM YYYY")+" - "+t.format("D MMMM YYYY"))},selectAll:function(){for(var n=0;n<this.sections.length;n++)this.sections[n].isSelected=!0},unselectAll:function(){for(var n=0;n<this.sections.length;n++)this.sections[n].isSelected=!1},selectOnlyType:function(n){for(var t=0;t<this.sections.length;t++)this.sections[t].isSelected=this.sections[t].sectionTypeID==n},selectAllTags:function(){this.userTags=this.userTags.map(function(n){return n.isShow=!1,n});this.tagify.addTags(this.userTags)},unselectAllTags:function(){this.tagify.removeAllTags();for(var n=0;n<this.userTags.length;n++)this.userTags[n].isShow=!0},selectedTag:function(n){this.tagify.addTags([n]);n.isShow=!1},addTag:function(n){let t=n.detail.data;if(t.isShow){let n=this.userTags.findIndex(n=>n.id==t.id);n!=-1&&(this.userTags[n].isShow=!1)}},removeTag:function(n){if(n.detail.data&&n.detail.data.id){let t=this.userTags.findIndex(t=>t.id==n.detail.data.id);t>=0&&(this.userTags[t].isShow=!0)}},onChooseSection:function(){},closeTimeline:function(){this.clearAllStyle()},GetDateByFormat:function(n,t){return GetDateByFormat(n,t)},getCurrencyValue:function(n,t,i){let r=new Intl.NumberFormat(UserInfo.Currency.SpecificCulture,{style:"currency",currency:UserInfo.Currency.CodeName}).format(t);if(UserInfo.Currency.ID!=n.currencyID&&i==undefined)try{r+=" ("+new Intl.NumberFormat(n.currencySpecificCulture,{style:"currency",currency:n.currencyCodeName}).format(CalculateExpression(n.tag))+")"}catch(u){}return r},add:function(){$("#modalTimeLine").modal("hide");setTimeout(RecordVue.showModal,750,this.dateTime,"BudgetVue.refreshAfterChangeRecords")}}});