var AreaVue=new Vue({el:"#area-vue",data:{areas:[],area:{},isSaving:!1,searchText:null},watch:{searchText:function(n){n&&(n=n.toLocaleLowerCase());for(var t=0;t<this.areas.length;t++)this.areas[t].isShow_Filtered=this.areas[t].name.toLocaleLowerCase().indexOf(n)>=0||this.areas[t].description&&this.areas[t].description.toLocaleLowerCase().indexOf(n)>=0}},mounted:function(){this.init()},methods:{init:function(){sendAjax("/Section/GetAllSectionForEdit",null,"GET").then(function(n){n.isOk&&(AreaVue.areas=n.areas)})},selectArea:function(n,t){document.querySelectorAll("#area-vue .area-item").forEach(function(n){n.classList.remove("active-item")});let i=this.areas.filter(t=>t.id==n)[0];$(".area-item[data-area-id="+i.id+"]").closest(".area-item").addClass("active-item");SectionVue.sections=i.sections;SectionVue.areaID=i.id;SectionVue.areaName=i.name;$("html, body").animate({scrollTop:$("#section-vue").offset().top-75},1e3);SectionVue.areas=this.areas.map(function(n){return{name:n.name,id:n.id}});t>0?SectionVue.edit(i.sections.filter(n=>n.id==t)[0]):t==-1&&SectionVue.create()},create:function(){this.area={id:undefined,name:this.searchText,isShowInCollective:!0,isShowOnSite:!0,isShow_Filtered:!0};$("#modal-area").modal("show")},edit:function(n){this.area=JSCopyObject(n);$("#modal-area").modal("show")},save:function(){return this.checkForm()==!1?!1:(this.isSaving=!0,sendAjax("/Section/SaveArea",this.area,"POST").then(function(n){if(n.isOk){AreaVue.area=n.area;let t=AreaVue.areas.findIndex(t=>t.id==n.area.id);t==-1?AreaVue.areas.push(n.area):AreaVue.areas[t]=n.area;SectionVue.areaID==n.area.id&&(SectionVue.areaName=n.area.name);$("#modal-area").modal("hide");AreaVue.isSaving=!1}}))},checkForm:function(n){let t=!0;this.area.name&&this.area.name.length>0||(t=!1);let i=this.area.name;return i=i?i.replaceAll(" ",""):"",i.length==0?(t=!1,$("#area-name").addClass("is-invalid")):$("#area-name").removeClass("is-invalid"),t==!1&&n&&n.preventDefault(),t},remove:function(n){n.isGlobal||(this.isSaving=!0,sendAjax("/Section/RemoveArea?id="+n.id,null,"POST").then(function(n){if(n.isOk&&n.wasDeleted){toastr.success(n.text);let t=AreaVue.areas.findIndex(t=>t.id==n.id);t!=-1&&AreaVue.areas.splice(t,1)}else n.isOk&&n.wasDeleted==!1?toastr.warning(n.text):toastr.error(n.text);AreaVue.isSaving=!1}))},updateSectionComponent:function(){for(var t,n=0;n<this.$children.length;n++){t=this.$children[n].dataId.replace("areaid_","");let i=this.areas.findIndex(n=>n.id==t),r=this.$children[n].updateSections(this.areas[i].sections)}},onChooseSection:function(n){this.selectArea(n.areaID,n.id)}}}),SectionVue=new Vue({el:"#section-vue",data:{sections:[],section:{},areaID:null,areaName:null,areas:[],icons:[],searchIcon:"",searchText:null,isSaving:!1,colors:[]},watch:{searchIcon:function(n){n&&(n=n.toLocaleLowerCase());for(var t=0;t<this.icons.length;t++)this.icons[t].isShowOnSite=this.icons[t].nameClass.toLocaleLowerCase().indexOf(n)>=0||this.icons[t].name.toLocaleLowerCase().indexOf(n)>=0},searchText:function(n){n&&(n=n.toLocaleLowerCase());for(var t=0;t<this.sections.length;t++)this.sections[t].isShow_Filtered=this.sections[t].name.toLocaleLowerCase().indexOf(n)>=0||this.sections[t].description&&this.sections[t].description.toLocaleLowerCase().indexOf(n)>=0}},mounted:function(){$.getJSON("/json/font-awesome.json",function(n){SectionVue.icons=n});$.getJSON("/json/colors-section.json",function(n){SectionVue.colors=n})},methods:{create:function(){this.section={name:this.searchText,areaID:this.areaID,isShowInCollective:!0,isShowOnSite:!0,isShow_Filtered:!0,sectionTypeID:null,hasRecords:!1,cssIcon:null,canRemove:!1};this.chooseColor();$("#accordion2-2, #accordion2-1").removeClass("show");this.changeSectionType(2);$("#modal-section").modal("show")},edit:function(n){this.section=JSCopyObject(n);$("#collectiveSections").select2();this.chooseColor(this.section.cssBackground);$("#accordion2-2, #accordion2-1").removeClass("show");$("#modal-section").modal("show")},removeSection:function(n){this.isSaving=!0;sendAjax("/Section/RemoveSection?id="+n.id,null,"POST").then(function(n){if(n.isOk&&n.wasDeleted){toastr.success(n.text);let t=SectionVue.sections.findIndex(t=>t.id==n.id);t!=-1&&SectionVue.sections.splice(t,1)}else n.isOk&&n.wasDeleted==!1?toastr.warning(n.text):toastr.error(n.text);SectionVue.isSaving=!1}).then(function(){RecordVue.refreshSections()})},selectIcon:function(n){this.section.cssIcon=n.nameClass;$("#accordion2-2, #accordion2-1").removeClass("show")},saveSection:function(){return this.checkForm()==!1?!1:(this.isSaving=!0,sendAjax("/Section/SaveSection",this.section,"POST").then(function(n){if(n.isOk){if(n.section.areaID==SectionVue.areaID){SectionVue.section=n.section;let i=SectionVue.sections.findIndex(t=>t.id==n.section.id),t=AreaVue.areas.findIndex(n=>n.id==SectionVue.areaID);if(i==-1)AreaVue.areas[t].sections.push(n.section);else{let i=AreaVue.areas[t].sections.findIndex(t=>t.id==n.section.id);AreaVue.areas[t].sections[i]=n.section}}else{let t=SectionVue.sections.findIndex(t=>t.id==n.section.id),i=AreaVue.areas.findIndex(n=>n.id==SectionVue.areaID);if(t!=-1){SectionVue.sections.splice(t,1);let r=AreaVue.areas[i].sections.findIndex(t=>t.id==n.section.id);AreaVue.areas[i].sections.splice(r,1);let u=AreaVue.areas.findIndex(t=>t.id==n.section.areaID);AreaVue.areas[u].sections.push(n.section)}}$("#modal-section").modal("hide");AreaVue.updateSectionComponent()}SectionVue.isSaving=!1}).then(function(){RecordVue.refreshSections()}))},checkForm:function(n){let t=!0;this.section.name&&this.section.name.length>0?$("#section-name").removeClass("is-invalid"):(t=!1,$("#section-name").addClass("is-invalid"));let i=this.section.name;return i=i?i.replaceAll(" ",""):"",i.length==0?(t=!1,$("#section-name").addClass("is-invalid")):$("#section-name").removeClass("is-invalid"),t==!1&&n&&n.preventDefault(),t},changeArea:function(n){this.section.areaID=n.target.selectedOptions[0].value;this.section.areaName=n.target.selectedOptions[0].text},changeSectionType:function(n){this.section.sectionTypeID=n},chooseColor:function(n){for(var t=0;t<this.colors.length;t++)this.colors[t].selected=!1;if(n){let t=this.colors.findIndex(t=>t.background==n);t!=-1&&(this.colors[t].selected=!0,this.section.cssColor=this.colors[t].color,this.section.cssBackground=this.colors[t].background);$("#accordion2-2, #accordion2-1").removeClass("show")}else this.section.cssColor="",this.section.cssBackground=""}}});