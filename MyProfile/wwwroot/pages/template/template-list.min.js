var TemplateListVue=new Vue({el:"#template-list-vue",data:{templates:[],activeTemplatePeriodTypeID:-1,search:null,msnry:{},preparedTemplate:{},template:{},isDetailsView:!1,isDetailsViewTable:!0,currentCount:0,limitCount:0,isSaving:!1},watch:{search:function(n){n||this.templates.forEach(function(n){n.isShow=!0});for(var t=0;t<this.templates.length;t++)this.templates[t].isShow=this.templates[t].name.indexOf(n)>=0}},mounted:function(){let n=document.getElementById("template-list-vue");this.currentCount=n.getAttribute("data-current-count")*1;this.limitCount=n.getAttribute("data-limit-count")*1;this.init().then(function(){TemplateListVue.msnry=new Masonry("#templates",{itemSelector:".masonry-item:not(.d-none)",columnWidth:".masonry-item-sizer",originLeft:!0,horizontalOrder:!0})})},methods:{init:function(){return this.refreshTemplates(),sendAjax("/Template/GetPreparedTemplates",null,"GET").then(function(n){n.isOk==!0&&(TemplateListVue.preparedTemplate=n.preparedTemplate)})},refreshTemplates:function(){sendAjax("/Template/GetTemplates",null,"GET").then(function(n){n.isOk==!0&&(TemplateListVue.templates=n.templates)})},getLinkForView:function(n){return TemplateGetLinkForView(n)},getDateByFormat:function(n,t){return GetDateByFormat(n,t)},reload:function(){setTimeout(function(){TemplateListVue.msnry.layout()},15)},getRusName:function(n){return GetRusName(n,["Колонка","Колонки","Колонок"])},remove:function(n){return ShowLoading("#template_"+n.id),$.ajax({type:"POST",url:"/Template/Remove",data:JSON.stringify(n),context:n,contentType:"application/json",dataType:"json",success:function(t){n.isDeleted=t.isOk;n.isDeleted&&(TemplateListVue.currentCount-=1);HideLoading("#template_"+n.id)}})},recovery:function(n){return ShowLoading("#template_"+n.id),$.ajax({type:"POST",url:"/Template/Recovery",data:JSON.stringify(n),context:n,contentType:"application/json",dataType:"json",success:function(t){t.isOk&&(n.isDeleted=!t.isOk,n.isDeleted==!1&&(TemplateListVue.currentCount+=1));HideLoading("#template_"+n.id)}})},toggleTemplate:function(n){return ShowLoading("#template_"+n),$.ajax({type:"GET",url:"/Template/ToggleTemplate?id="+n,contentType:"application/json",dataType:"json",context:n,success:function(n){HideLoading("#template_"+this);(n.isOk=!0)&&TemplateListVue.init()},error:function(){HideLoading("#template_"+this)}})},saveTemplate:function(n,t){this.isSaving=!0;let i="/Template/SavePreparedTemplate";return t&&(i="/Template/SavePreparedTemplateAndEdit"),$.ajax({type:"POST",url:i,context:this,data:JSON.stringify(n),contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){return n.isOk?(toastr.success("Шаблон сохранен успешно"),$("#prepared-template-model").modal("hide"),this.isDetailsView=!1,this.currentCount+=1,n.href?window.document.location.href=n.href:this.refreshTemplates()):toastr.error("Не удалось сохранить шаблон."),this.isSaving=!1,!0},error:function(n,t,i){this.isSaving=!1;console.log(i)}})},showTemplate:function(n){this.template=n;this.isDetailsView=!0;this.isDetailsViewTable=!0},isBudgetSection:function(n){return n==TemplateColumnTypeEnum.BudgetSection},isDaysForMonth:function(n){return n==TemplateColumnTypeEnum.DaysForMonth},isMonthsForYear:function(n){return n==TemplateColumnTypeEnum.MonthsForYear},selectPeriod:function(n){for(var t=0;t<this.preparedTemplate.periods.length;t++)this.preparedTemplate.periods[t].isSelected=!1;n.isSelected=!0},showPreparedModel:function(){this.isDetailsView=!1;$("#prepared-template-model").modal("show")}}});