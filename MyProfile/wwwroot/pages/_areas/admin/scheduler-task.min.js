var TaskVue=new Vue({el:"#task-vue",data:{statuses:[1,2,3,4,5],row:[],forceTaskIDs:[1,2,3,4,5,9,10,11,12,13],dataTable:undefined,tableAjax:null},computed:{},watch:{},mounted:function(){this.search()},methods:{search:function(){this.dataTable&&(this.dataTable=undefined,$("#table").DataTable().destroy());this.tableAjax=$.ajax({type:"POST",context:this,contentType:"application/json; charset=utf-8",dataType:"json",url:"/Admin/SchedulerTask/GetData",data:function(n){return n.filter={},n},success:function(n){return this.row=n.data,setTimeout(function(){TaskVue.dataTable=$("#table").DataTable({columnDefs:[{targets:"_all",className:"column-min-width",orderDataType:"dom-text-numeric",type:"num"},],colReorder:{realtime:!1}});setTimeout(function(){$('[data-toggle="tooltip"]').tooltip()},500)},100),n.data},error:function(n,t,i){console.log(n);console.log(i);TaskVue.isDisabled(!1)}})},getTD:function(n){let t="",i="<span class='float-right'>";if(this.forceTaskIDs.indexOf(n.id)>=0&&(i+=`<a href="javascript:void(0)" class="btn btn-default btn-xs icon-btn md-btn-flat product-tooltip" title="Force start" data-toggle="tooltip"
                    onclick="TaskVue.forceStart(${n.id})">
                    <i class="ion ion-md-play"></i></a>`),t+="<td>"+n.id+i+"<\/span><\/td > ",t+="<td>"+n.name+"<\/td>",t+=n.firstStart?"<td>"+moment(n.firstStart).format("DD.MM.YYYY HH:mm")+"<\/td>":"<td><\/td>",t+=n.lastStart?"<td>"+moment(n.lastStart).format("DD.MM.YYYY HH:mm")+"<\/td>":"<td><\/td>",n.nextStart){let i="";n.isMissed&&(i='<a href="javascript:void(0)" class="badge badge-pill badge-danger">Missed<\/a>');t+="<td>"+moment(n.nextStart).format("DD.MM.YYYY HH:mm")+" "+i+"<\/td > "}else t+="<td><\/td>";return t+="<td data-id-status='"+n.id+"'>"+this.status(n.id,n.taskStatus)+"<\/td>",t+="<td>"+n.cronComment+"<\/td>",t+="<td>"+n.cronExpression+"<\/td>",t+="<td>"+(n.comment?n.comment:"")+"<\/td>"},status:function(n,t){let i="btn-secondary";return t=="New"?i="btn-primary":t=="InProcess"?i="btn-success":t=="Stop"?i="btn-warning":t=="Error"&&(i="btn-danger"),'<div class="ticket-priority btn-group"><button type="button" class="btn btn-xs md-btn-flat dropdown-toggle '+i+'" data-toggle="dropdown">'+t+'<\/button><div class="dropdown-menu"><a class="dropdown-item" href="javascript:void(0)" onclick="TaskVue.setStatus('+n+', 1)">New<\/a><a class="dropdown-item" href="javascript:void(0)" onclick="TaskVue.setStatus('+n+', 2)">InProcess<\/a><a class="dropdown-item" href="javascript:void(0)" onclick="TaskVue.setStatus('+n+', 3)">Stop<\/a><a class="dropdown-item" href="javascript:void(0)" onclick="TaskVue.setStatus('+n+', 4)">Error<\/a><\/div><\/div>'},setStatus:function(n,t){$.ajax({type:"Get",contentType:"application/json; charset=utf-8",dataType:"json",url:"/Admin/SchedulerTask/SetNewStatus?taskID="+n+"&newStatusID="+t,context:this,success:function(t){t.isOk?($("td[data-id-status="+n+"]").html(this.status(n,t.newTaskStatus)),toastr.success("Force start success")):toastr.error("Error")},error:function(n,t,i){console.log(n);console.log(i);TaskVue.isDisabled(!1)}})},forceStart:function(n){$.ajax({type:"Get",contentType:"application/json; charset=utf-8",dataType:"json",url:"/Admin/SchedulerTask/ForceStart?taskID="+n,context:this,success:function(n){return n.isOk?(toastr.success("Force start success"),this.search()):toastr.error("Error"),n.data},error:function(n,t,i){console.log(n);console.log(i);TaskVue.isDisabled(!1)}})},getDateByFormat:function(n,t){return n&&moment(n).isValid()?moment(n).format(t):""}}});